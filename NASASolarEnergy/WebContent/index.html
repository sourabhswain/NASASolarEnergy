<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>jQuery UI Slider - Range slider</title>
<link rel="stylesheet"
	href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="css/sheet1.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->
<script>
	var filteredRes = [];
	var sumRadiation = 0;
	var powerGenerated = 0;
	var filteredProducts = [];
	var areaSolarPanel = 72;
	var efficiency = 0.015;//by defautl Monocrystalline Panels

	$(function() {

		$("#slider-range").slider(
				{
					range : true,
					min : 0,
					max : 24,
					values : [ 0, 0 ],
					slide : function(event, ui) {
						sumRadiation = 0;
						powerGenerated = 0;
						filteredProducts = [];
						$("#amount").val(
								ui.values[0] + " - " + ui.values[1] + " hrs");
						filteredRes.forEach(function(radiationObj) {
							var loopTime = parseInt(radiationObj.TIME
									.split(":")[0]);
							if (loopTime >= parseInt(ui.values[0])
									&& loopTime < parseInt(ui.values[1])) {
								sumRadiation += radiationObj.RADIATION;
							}
						});
						console.log("efficiency" + efficiency);
						console.log("sumRadiation " + sumRadiation);
						powerGenerated = sumRadiation * areaSolarPanel
								* efficiency; //as per puneet requirment
						console.log("powerGenerated " + powerGenerated);

						this.xhr = $.ajax({
							crossDomain : true,
							url : "data/convertcsv2.json",
							type : "get",
							accept : "application/json",
							contentType : "application/json; charset=utf-8",
							dataType : "json",
							success : function(response) {
								filteredProducts = [];
								response.forEach(function(powerObj) {
									if (powerObj.POWER <= powerGenerated) {
										filteredProducts.push(powerObj);
									}
								});
								// Clear all images meaning remove all devices
								$("#imagesList").empty();
								console.log(filteredRes.length);
								console.log(filteredProducts);

								//load image array adding images to div 

								$.each(filteredProducts, function() {

									var path = this.IMAGE_URL;
									console.log(path);

									$('<img />').attr('src', "" + path + "") // ADD IMAGE PROPERTIES.
									.width('140px').height('140px').appendTo(
											$('#imagesList'));
								});

							},
							error : function(xhr, status, error) {
								var err = JSON.parse(xhr.responseText);
								console(err.Message);
							},
							fail : function(response) {
								console.log("fail");
								console.log(response)
							}
						});
					}
				});
		$("#amount").val(
				$("#slider-range").slider("values", 0) + " - "
						+ $("#slider-range").slider("values", 1) + " hrs");

		var $slider = $('#slider-range');
		var max = $slider.slider("option", "max");
		var spacing = 5;

		$slider.find('.ui-slider-tick-mark').remove();
		for (var i = 0; i < max - 3; i++) {
			$('<span class="ui-slider-tick-mark"></span>').css('left',
					(spacing * i) + '%').appendTo($slider);
		}
		$("#datepicker").datepicker(
				{
					prevText : "Earlier",
					defaultDate : new Date(2016, 08, 01),
					onSelect : function(date) {
						console.log(date);
						var d = new Date(date);
						console.log("d.getDate() " + d.getDate());
						console.log("d.getMonth() " + d.getMonth());
						console.log("d.getDay() " + d.getFullYear());
						var data;
						$.support.cors = true;
						this.xhr = $.ajax({
							crossDomain : true,
							url : "data/convertcsv.json",
							type : "get",
							accept : "application/json",
							contentType : "application/json; charset=utf-8",
							dataType : "json",
							success : function(response) {
								console.log("success");
								console.log(response[0].DATE + ", " + date);
								var selectedDate = $.datepicker.parseDate(
										"yy-mm-dd", date);
								filteredRes = [];
								response.forEach(function(radiationObj) {
									var loopDate = $.datepicker.parseDate(
											"yy-mm-dd", radiationObj.DATE);
									if (loopDate.getTime() === selectedDate
											.getTime()) {
										filteredRes.push(radiationObj);
									}
								});
								console.log(filteredRes.length);
							},
							error : function(xhr, status, error) {
								var err = JSON.parse(xhr.responseText);
								console(err.Message);
							},
							fail : function(response) {
								console.log("fail");
								console.log(response)
							}
						});
						$("#ui-datepicker-div").hide();
					},
					dateFormat : 'yy-mm-dd'
				});
	});

	$(function() {
		var panel_image = $("#panel_image");

		$("#panel").selectmenu({
			change : function(event, data) {
				$('#panel_image').attr("src", $('#panel').val());
				//as per selection of panel updating the efficiency var
				var name = $("#panel :selected").text();
				if (name == "Monocrystalline Panels(15%)") {
					efficiency = 0.015;
				} else if (name == "Polycrystalline Panels(13%)") {
					efficiency = 0.013;
				} else if (name == "Thin film solar Panels(10%)") {
					efficiency = 0.010;
				}

				console.log("efficiency" + efficiency);
			}
		});

	});
</script>
</head>
<body style="background-color: #fafafa">
	<div>


		<div style="text-align: center">
			<h1>Solar Power Enabling Life - Future Martians</h1>
		</div>
		</p>
	</div>
	<div>
		<p>
		<p>
			Date: <input type="text" id="datepicker" onclick="click()">
		</p>
		<input type="text" id="amount" readonly
			style="border: 0; color: #f6931f; font-weight: bold;">

		</p>
		<div id="slider-range" style="width: 100%"></div>
	</div>
	<br>
	<div style="width: 50%; float: left;">
		<div style="margin-left: 15%">
			<img src="img/images.jpg" width="30%">
		</div>
		<div style="width: 100%">
			<img id="panel_image" src="img/monocrystalline.png"
				style="float: right; width: 30%; margin-right: 15%">
		</div>
		<div style="padding-top: 10%;">
			<h2>Select the type of panel:</h2>
			<select id="panel" style="margin-left: 10%">
				<option value="img/monocrystalline.png">Monocrystalline
					Panels(15%)</option>
				<option value="img/polycrystalline.jpg">Polycrystalline
					Panels(13%)</option>
				<option value="img/thin_film_solar_panels.jpg">Thin film
					solar Panels(10%)</option>
			</select>
		</div>
	</div>
	<div style="width: 49%; float: right; margin-left: 1%">
		<!-- <img src="img/sunrays.jpg"> <img src="img/sunrays.jpg"> <img
			src="img/sunrays.jpg"> <img src="img/sunrays.jpg"> -->
		<!-- <ul id="imagesList">
			  <li>No images found</li>
			</ul> -->

		<div id="imagesList" style="width: auto;"></div>


	</div>
</body>
</html>
